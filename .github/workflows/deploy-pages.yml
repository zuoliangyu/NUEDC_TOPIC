name: è‡ªåŠ¨éƒ¨ç½²åˆ° GitHub Pages

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

# å…è®¸æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ
  workflow_dispatch:

# è®¾ç½® GITHUB_TOKEN çš„æƒé™ï¼Œå…è®¸éƒ¨ç½²åˆ° GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# åªå…è®¸ä¸€ä¸ªå¹¶å‘éƒ¨ç½²ï¼Œè·³è¿‡æ­£åœ¨è¿è¡Œå’Œæœ€æ–°æ’é˜Ÿä¹‹é—´çš„è¿è¡Œ
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # æ„å»ºä»»åŠ¡
  build:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # è·å–æ‰€æœ‰å†å²è®°å½•ç”¨äºæ›´å¥½çš„ç¼“å­˜

      - name: è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: å®‰è£… docsify-cli
        run: npm i docsify-cli -g

      - name: åˆ›å»ºæ„å»ºç›®å½•
        run: mkdir -p dist

      - name: å¤åˆ¶æ–‡æ¡£æ–‡ä»¶
        run: |
          cp README.md dist/
          cp -r çœŸé¢˜ dist/
          cp -r assets dist/
          cp -r ç»¼åˆæµ‹è¯„ dist/

      - name: åˆ›å»º docsify é…ç½®æ–‡ä»¶
        run: |
          cat > dist/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="zh-CN">
          <head>
            <meta charset="UTF-8">
            <title>å…¨å›½å¤§å­¦ç”Ÿç”µå­è®¾è®¡ç«èµ›å†å¹´çœŸé¢˜</title>
            <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
            <meta name="description" content="å…¨å›½å¤§å­¦ç”Ÿç”µå­è®¾è®¡ç«èµ›å†å¹´çœŸé¢˜åœ¨çº¿æµè§ˆ">
            <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
            <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
            <link rel="icon" href="./assets/LOGO/NUEDC_LOGO.jpg">
          </head>
          <body>
            <div id="app">åŠ è½½ä¸­...</div>
            <script>
              window.$docsify = {
                name: 'ç”µèµ›å†å¹´çœŸé¢˜',
                repo: 'https://github.com/zuoliangyu/NUEDC_TOPIC',
                loadSidebar: true,
                subMaxLevel: 3,
                auto2top: true,
                search: {
                  placeholder: 'æœç´¢',
                  noData: 'æ²¡æœ‰æ‰¾åˆ°ç»“æœ',
                  depth: 6
                },
                plugins: [
                  function(hook, vm) {
                    hook.beforeEach(function(html) {
                      return html + '\n\n----\n\n<footer>Â© 2025 å…¨å›½å¤§å­¦ç”Ÿç”µå­è®¾è®¡ç«èµ›å†å¹´çœŸé¢˜ | æ›´æ–°æ—¶é—´: ' + new Date().toLocaleString('zh-CN') + '</footer>';
                    });
                  }
                ]
              }
            </script>
            <!-- docsify æ ¸å¿ƒæ–‡ä»¶ -->
            <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>
            <!-- æœç´¢æ’ä»¶ -->
            <script src="//cdn.jsdelivr.net/npm/docsify@4/lib/plugins/search.min.js"></script>
            <!-- ä»£ç é«˜äº® -->
            <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-bash.min.js"></script>
            <!-- PDF åµŒå…¥æ’ä»¶ -->
            <script src="//cdn.jsdelivr.net/npm/docsify-pdf-embed-plugin/src/docsify-pdf-embed.js"></script>
            <!-- å›¾ç‰‡ç¼©æ”¾ -->
            <script src="//cdn.jsdelivr.net/npm/docsify@4/lib/plugins/zoom-image.min.js"></script>
            <!-- å¤åˆ¶åˆ°å‰ªè´´æ¿ -->
            <script src="//cdn.jsdelivr.net/npm/docsify-copy-code@2/dist/docsify-copy-code.min.js"></script>
          </body>
          </html>
          EOF

      - name: ç”Ÿæˆä¾§è¾¹æ 
        run: |
          cat > dist/_sidebar.md << 'EOF'
          * [é¦–é¡µ](/)
          
          * ğŸ“š å†å¹´çœŸé¢˜
            * [1994-2007 å¹´](çœŸé¢˜/1994-2007/)
            * [2009 å¹´](çœŸé¢˜/2009/)
            * [2010 å¹´](çœŸé¢˜/2010/)
            * [2011 å¹´](çœŸé¢˜/2011/)
            * [2012 å¹´](çœŸé¢˜/2012/)
            * [2013 å¹´](çœŸé¢˜/2013/)
            * [2014 å¹´](çœŸé¢˜/2014/)
            * [2015 å¹´](çœŸé¢˜/2015/)
            * [2016 å¹´](çœŸé¢˜/2016/)
            * [2017 å¹´](çœŸé¢˜/2017/)
            * [2018 å¹´](çœŸé¢˜/2018/)
            * [2019 å¹´](çœŸé¢˜/2019/)
            * [2020 å¹´](çœŸé¢˜/2020/)
            * [2021 å¹´](çœŸé¢˜/2021/)
            * [2022 å¹´](çœŸé¢˜/2022/)
            * [2023 å¹´](çœŸé¢˜/2023/)
            * [2024 å¹´](çœŸé¢˜/2024/)
            * [2025 å¹´](çœŸé¢˜/2025/)
          
          * ğŸ† ç»¼åˆæµ‹è¯„
            * [ç»¼åˆæµ‹è¯„é¢˜ç›®](ç»¼åˆæµ‹è¯„/)
          
          * ğŸ“– ä½¿ç”¨è¯´æ˜
            * [åœ¨çº¿è®¿é—®åŠŸèƒ½](#åœ¨çº¿è®¿é—®)
            * [è´¡çŒ®æŒ‡å—](#è´¡çŒ®)
          EOF

      - name: åˆ›å»º .nojekyll æ–‡ä»¶
        run: touch dist/.nojekyll

      - name: ä¸Šä¼ æ„å»ºäº§ç‰©
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./dist

  # éƒ¨ç½²ä»»åŠ¡
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: éƒ¨ç½²åˆ° GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4